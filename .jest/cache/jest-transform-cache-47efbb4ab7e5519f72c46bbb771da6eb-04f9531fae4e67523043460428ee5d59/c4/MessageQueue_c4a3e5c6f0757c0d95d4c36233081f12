9e71217905b8a5b161975e6c8402cbae
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var Systrace = require('../Performance/Systrace');

var deepFreezeAndThrowOnMutationInDev = require('../Utilities/deepFreezeAndThrowOnMutationInDev');

var stringifySafe = require('../Utilities/stringifySafe').default;

var warnOnce = require('../Utilities/warnOnce');

var ErrorUtils = require('../vendor/core/ErrorUtils');

var invariant = require('invariant');

var TO_JS = 0;
var TO_NATIVE = 1;
var MODULE_IDS = 0;
var METHOD_IDS = 1;
var PARAMS = 2;
var MIN_TIME_BETWEEN_FLUSHES_MS = 5;
var TRACE_TAG_REACT_APPS = 1 << 17;
var DEBUG_INFO_LIMIT = 32;

var MessageQueue = function () {
  function MessageQueue() {
    (0, _classCallCheck2.default)(this, MessageQueue);
    this._lazyCallableModules = {};
    this._queue = [[], [], [], 0];
    this._successCallbacks = new Map();
    this._failureCallbacks = new Map();
    this._callID = 0;
    this._lastFlush = 0;
    this._eventLoopStartTime = Date.now();
    this._reactNativeMicrotasksCallback = null;

    if (__DEV__) {
      this._debugInfo = {};
      this._remoteModuleTable = {};
      this._remoteMethodTable = {};
    }

    this.callFunctionReturnFlushedQueue = this.callFunctionReturnFlushedQueue.bind(this);
    this.flushedQueue = this.flushedQueue.bind(this);
    this.invokeCallbackAndReturnFlushedQueue = this.invokeCallbackAndReturnFlushedQueue.bind(this);
  }

  (0, _createClass2.default)(MessageQueue, [{
    key: "callFunctionReturnFlushedQueue",
    value: function callFunctionReturnFlushedQueue(module, method, args) {
      var _this = this;

      this.__guard(function () {
        _this.__callFunction(module, method, args);
      });

      return this.flushedQueue();
    }
  }, {
    key: "invokeCallbackAndReturnFlushedQueue",
    value: function invokeCallbackAndReturnFlushedQueue(cbID, args) {
      var _this2 = this;

      this.__guard(function () {
        _this2.__invokeCallback(cbID, args);
      });

      return this.flushedQueue();
    }
  }, {
    key: "flushedQueue",
    value: function flushedQueue() {
      var _this3 = this;

      this.__guard(function () {
        _this3.__callReactNativeMicrotasks();
      });

      var queue = this._queue;
      this._queue = [[], [], [], this._callID];
      return queue[0].length ? queue : null;
    }
  }, {
    key: "getEventLoopRunningTime",
    value: function getEventLoopRunningTime() {
      return Date.now() - this._eventLoopStartTime;
    }
  }, {
    key: "registerCallableModule",
    value: function registerCallableModule(name, module) {
      this._lazyCallableModules[name] = function () {
        return module;
      };
    }
  }, {
    key: "registerLazyCallableModule",
    value: function registerLazyCallableModule(name, factory) {
      var module;
      var getValue = factory;

      this._lazyCallableModules[name] = function () {
        if (getValue) {
          module = getValue();
          getValue = null;
        }

        return module;
      };
    }
  }, {
    key: "getCallableModule",
    value: function getCallableModule(name) {
      var getValue = this._lazyCallableModules[name];
      return getValue ? getValue() : null;
    }
  }, {
    key: "callNativeSyncHook",
    value: function callNativeSyncHook(moduleID, methodID, params, onFail, onSucc) {
      if (__DEV__) {
        invariant(global.nativeCallSyncHook, 'Calling synchronous methods on native ' + 'modules is not supported in Chrome.\n\n Consider providing alternative ' + 'methods to expose this method in debug mode, e.g. by exposing constants ' + 'ahead-of-time.');
      }

      this.processCallbacks(moduleID, methodID, params, onFail, onSucc);
      return global.nativeCallSyncHook(moduleID, methodID, params);
    }
  }, {
    key: "processCallbacks",
    value: function processCallbacks(moduleID, methodID, params, onFail, onSucc) {
      var _this4 = this;

      if (onFail || onSucc) {
        if (__DEV__) {
          this._debugInfo[this._callID] = [moduleID, methodID];

          if (this._callID > DEBUG_INFO_LIMIT) {
            delete this._debugInfo[this._callID - DEBUG_INFO_LIMIT];
          }

          if (this._successCallbacks.size > 500) {
            var info = {};

            this._successCallbacks.forEach(function (_, callID) {
              var debug = _this4._debugInfo[callID];
              var module = debug && _this4._remoteModuleTable[debug[0]];
              var method = debug && _this4._remoteMethodTable[debug[0]][debug[1]];
              info[callID] = {
                module: module,
                method: method
              };
            });

            warnOnce('excessive-number-of-pending-callbacks', "Please report: Excessive number of pending callbacks: " + this._successCallbacks.size + ". Some pending callbacks that might have leaked by never being called from native code: " + stringifySafe(info));
          }
        }

        onFail && params.push(this._callID << 1);
        onSucc && params.push(this._callID << 1 | 1);

        this._successCallbacks.set(this._callID, onSucc);

        this._failureCallbacks.set(this._callID, onFail);
      }

      if (__DEV__) {
        global.nativeTraceBeginAsyncFlow && global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS, 'native', this._callID);
      }

      this._callID++;
    }
  }, {
    key: "enqueueNativeCall",
    value: function enqueueNativeCall(moduleID, methodID, params, onFail, onSucc) {
      this.processCallbacks(moduleID, methodID, params, onFail, onSucc);

      this._queue[MODULE_IDS].push(moduleID);

      this._queue[METHOD_IDS].push(methodID);

      if (__DEV__) {
        var isValidArgument = function isValidArgument(val) {
          switch (typeof val) {
            case 'undefined':
            case 'boolean':
            case 'string':
              return true;

            case 'number':
              return isFinite(val);

            case 'object':
              if (val == null) {
                return true;
              }

              if (Array.isArray(val)) {
                return val.every(isValidArgument);
              }

              for (var k in val) {
                if (typeof val[k] !== 'function' && !isValidArgument(val[k])) {
                  return false;
                }
              }

              return true;

            case 'function':
              return false;

            default:
              return false;
          }
        };

        var replacer = function replacer(key, val) {
          var t = typeof val;

          if (t === 'function') {
            return '<<Function ' + val.name + '>>';
          } else if (t === 'number' && !isFinite(val)) {
            return '<<' + val.toString() + '>>';
          } else {
            return val;
          }
        };

        invariant(isValidArgument(params), '%s is not usable as a native method argument', JSON.stringify(params, replacer));
        deepFreezeAndThrowOnMutationInDev(params);
      }

      this._queue[PARAMS].push(params);

      var now = Date.now();

      if (global.nativeFlushQueueImmediate && now - this._lastFlush >= MIN_TIME_BETWEEN_FLUSHES_MS) {
        var queue = this._queue;
        this._queue = [[], [], [], this._callID];
        this._lastFlush = now;
        global.nativeFlushQueueImmediate(queue);
      }

      Systrace.counterEvent('pending_js_to_native_queue', this._queue[0].length);

      if (__DEV__ && this.__spy && isFinite(moduleID)) {
        this.__spy({
          type: TO_NATIVE,
          module: this._remoteModuleTable[moduleID],
          method: this._remoteMethodTable[moduleID][methodID],
          args: params
        });
      } else if (this.__spy) {
        this.__spy({
          type: TO_NATIVE,
          module: moduleID + '',
          method: methodID,
          args: params
        });
      }
    }
  }, {
    key: "createDebugLookup",
    value: function createDebugLookup(moduleID, name, methods) {
      if (__DEV__) {
        this._remoteModuleTable[moduleID] = name;
        this._remoteMethodTable[moduleID] = methods || [];
      }
    }
  }, {
    key: "setReactNativeMicrotasksCallback",
    value: function setReactNativeMicrotasksCallback(fn) {
      this._reactNativeMicrotasksCallback = fn;
    }
  }, {
    key: "__guard",
    value: function __guard(fn) {
      if (this.__shouldPauseOnThrow()) {
        fn();
      } else {
        try {
          fn();
        } catch (error) {
          ErrorUtils.reportFatalError(error);
        }
      }
    }
  }, {
    key: "__shouldPauseOnThrow",
    value: function __shouldPauseOnThrow() {
      return typeof DebuggerInternal !== 'undefined' && DebuggerInternal.shouldPauseOnThrow === true;
    }
  }, {
    key: "__callReactNativeMicrotasks",
    value: function __callReactNativeMicrotasks() {
      Systrace.beginEvent('JSTimers.callReactNativeMicrotasks()');

      if (this._reactNativeMicrotasksCallback != null) {
        this._reactNativeMicrotasksCallback();
      }

      Systrace.endEvent();
    }
  }, {
    key: "__callFunction",
    value: function __callFunction(module, method, args) {
      this._lastFlush = Date.now();
      this._eventLoopStartTime = this._lastFlush;

      if (__DEV__ || this.__spy) {
        Systrace.beginEvent(module + "." + method + "(" + stringifySafe(args) + ")");
      } else {
        Systrace.beginEvent(module + "." + method + "(...)");
      }

      if (this.__spy) {
        this.__spy({
          type: TO_JS,
          module: module,
          method: method,
          args: args
        });
      }

      var moduleMethods = this.getCallableModule(module);

      if (!moduleMethods) {
        var callableModuleNames = Object.keys(this._lazyCallableModules);
        var n = callableModuleNames.length;
        var callableModuleNameList = callableModuleNames.join(', ');
        invariant(false, "Failed to call into JavaScript module method " + module + "." + method + "(). Module has not been registered as callable. Registered callable JavaScript modules (n = " + n + "): " + callableModuleNameList + ".\n        A frequent cause of the error is that the application entry file path is incorrect. This can also happen when the JS bundle is corrupt or there is an early initialization error when loading React Native.");
      }

      if (!moduleMethods[method]) {
        invariant(false, "Failed to call into JavaScript module method " + module + "." + method + "(). Module exists, but the method is undefined.");
      }

      moduleMethods[method].apply(moduleMethods, args);
      Systrace.endEvent();
    }
  }, {
    key: "__invokeCallback",
    value: function __invokeCallback(cbID, args) {
      this._lastFlush = Date.now();
      this._eventLoopStartTime = this._lastFlush;
      var callID = cbID >>> 1;
      var isSuccess = cbID & 1;
      var callback = isSuccess ? this._successCallbacks.get(callID) : this._failureCallbacks.get(callID);

      if (__DEV__) {
        var debug = this._debugInfo[callID];

        var _module = debug && this._remoteModuleTable[debug[0]];

        var method = debug && this._remoteMethodTable[debug[0]][debug[1]];
        invariant(callback, "No callback found with cbID " + cbID + " and callID " + callID + " for " + (method ? " " + _module + "." + method + " - most likely the callback was already invoked" : "module " + (_module || '<unknown>')) + (". Args: '" + stringifySafe(args) + "'"));
        var profileName = debug ? '<callback for ' + _module + '.' + method + '>' : cbID;

        if (callback && this.__spy) {
          this.__spy({
            type: TO_JS,
            module: null,
            method: profileName,
            args: args
          });
        }

        Systrace.beginEvent("MessageQueue.invokeCallback(" + profileName + ", " + stringifySafe(args) + ")");
      }

      if (!callback) {
        return;
      }

      this._successCallbacks.delete(callID);

      this._failureCallbacks.delete(callID);

      callback.apply(void 0, (0, _toConsumableArray2.default)(args));

      if (__DEV__) {
        Systrace.endEvent();
      }
    }
  }], [{
    key: "spy",
    value: function spy(spyOrToggle) {
      if (spyOrToggle === true) {
        MessageQueue.prototype.__spy = function (info) {
          console.log((info.type === TO_JS ? 'N->JS' : 'JS->N') + " : " + ("" + (info.module != null ? info.module + '.' : '') + info.method) + ("(" + JSON.stringify(info.args) + ")"));
        };
      } else if (spyOrToggle === false) {
        MessageQueue.prototype.__spy = null;
      } else {
        MessageQueue.prototype.__spy = spyOrToggle;
      }
    }
  }]);
  return MessageQueue;
}();

module.exports = MessageQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTeXN0cmFjZSIsInJlcXVpcmUiLCJkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYiLCJzdHJpbmdpZnlTYWZlIiwiZGVmYXVsdCIsIndhcm5PbmNlIiwiRXJyb3JVdGlscyIsImludmFyaWFudCIsIlRPX0pTIiwiVE9fTkFUSVZFIiwiTU9EVUxFX0lEUyIsIk1FVEhPRF9JRFMiLCJQQVJBTVMiLCJNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIkRFQlVHX0lORk9fTElNSVQiLCJNZXNzYWdlUXVldWUiLCJfbGF6eUNhbGxhYmxlTW9kdWxlcyIsIl9xdWV1ZSIsIl9zdWNjZXNzQ2FsbGJhY2tzIiwiTWFwIiwiX2ZhaWx1cmVDYWxsYmFja3MiLCJfY2FsbElEIiwiX2xhc3RGbHVzaCIsIl9ldmVudExvb3BTdGFydFRpbWUiLCJEYXRlIiwibm93IiwiX3JlYWN0TmF0aXZlTWljcm90YXNrc0NhbGxiYWNrIiwiX19ERVZfXyIsIl9kZWJ1Z0luZm8iLCJfcmVtb3RlTW9kdWxlVGFibGUiLCJfcmVtb3RlTWV0aG9kVGFibGUiLCJjYWxsRnVuY3Rpb25SZXR1cm5GbHVzaGVkUXVldWUiLCJiaW5kIiwiZmx1c2hlZFF1ZXVlIiwiaW52b2tlQ2FsbGJhY2tBbmRSZXR1cm5GbHVzaGVkUXVldWUiLCJtb2R1bGUiLCJtZXRob2QiLCJhcmdzIiwiX19ndWFyZCIsIl9fY2FsbEZ1bmN0aW9uIiwiY2JJRCIsIl9faW52b2tlQ2FsbGJhY2siLCJfX2NhbGxSZWFjdE5hdGl2ZU1pY3JvdGFza3MiLCJxdWV1ZSIsImxlbmd0aCIsIm5hbWUiLCJmYWN0b3J5IiwiZ2V0VmFsdWUiLCJtb2R1bGVJRCIsIm1ldGhvZElEIiwicGFyYW1zIiwib25GYWlsIiwib25TdWNjIiwiZ2xvYmFsIiwibmF0aXZlQ2FsbFN5bmNIb29rIiwicHJvY2Vzc0NhbGxiYWNrcyIsInNpemUiLCJpbmZvIiwiZm9yRWFjaCIsIl8iLCJjYWxsSUQiLCJkZWJ1ZyIsInB1c2giLCJzZXQiLCJuYXRpdmVUcmFjZUJlZ2luQXN5bmNGbG93IiwiaXNWYWxpZEFyZ3VtZW50IiwidmFsIiwiaXNGaW5pdGUiLCJBcnJheSIsImlzQXJyYXkiLCJldmVyeSIsImsiLCJyZXBsYWNlciIsImtleSIsInQiLCJ0b1N0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJuYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlIiwiY291bnRlckV2ZW50IiwiX19zcHkiLCJ0eXBlIiwibWV0aG9kcyIsImZuIiwiX19zaG91bGRQYXVzZU9uVGhyb3ciLCJlcnJvciIsInJlcG9ydEZhdGFsRXJyb3IiLCJEZWJ1Z2dlckludGVybmFsIiwic2hvdWxkUGF1c2VPblRocm93IiwiYmVnaW5FdmVudCIsImVuZEV2ZW50IiwibW9kdWxlTWV0aG9kcyIsImdldENhbGxhYmxlTW9kdWxlIiwiY2FsbGFibGVNb2R1bGVOYW1lcyIsIk9iamVjdCIsImtleXMiLCJuIiwiY2FsbGFibGVNb2R1bGVOYW1lTGlzdCIsImpvaW4iLCJhcHBseSIsImlzU3VjY2VzcyIsImNhbGxiYWNrIiwiZ2V0IiwicHJvZmlsZU5hbWUiLCJkZWxldGUiLCJzcHlPclRvZ2dsZSIsInByb3RvdHlwZSIsImNvbnNvbGUiLCJsb2ciLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiTWVzc2FnZVF1ZXVlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvdyBzdHJpY3RcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IFN5c3RyYWNlID0gcmVxdWlyZSgnLi4vUGVyZm9ybWFuY2UvU3lzdHJhY2UnKTtcbmNvbnN0IGRlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldiA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9kZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYnKTtcbmNvbnN0IHN0cmluZ2lmeVNhZmUgPSByZXF1aXJlKCcuLi9VdGlsaXRpZXMvc3RyaW5naWZ5U2FmZScpLmRlZmF1bHQ7XG5jb25zdCB3YXJuT25jZSA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy93YXJuT25jZScpO1xuY29uc3QgRXJyb3JVdGlscyA9IHJlcXVpcmUoJy4uL3ZlbmRvci9jb3JlL0Vycm9yVXRpbHMnKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5leHBvcnQgdHlwZSBTcHlEYXRhID0ge1xuICB0eXBlOiBudW1iZXIsXG4gIG1vZHVsZTogP3N0cmluZyxcbiAgbWV0aG9kOiBzdHJpbmcgfCBudW1iZXIsXG4gIGFyZ3M6IG1peGVkW10sXG4gIC4uLlxufTtcblxuY29uc3QgVE9fSlMgPSAwO1xuY29uc3QgVE9fTkFUSVZFID0gMTtcblxuY29uc3QgTU9EVUxFX0lEUyA9IDA7XG5jb25zdCBNRVRIT0RfSURTID0gMTtcbmNvbnN0IFBBUkFNUyA9IDI7XG5jb25zdCBNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMgPSA1O1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuY29uc3QgVFJBQ0VfVEFHX1JFQUNUX0FQUFMgPSAxIDw8IDE3O1xuXG5jb25zdCBERUJVR19JTkZPX0xJTUlUID0gMzI7XG5cbmNsYXNzIE1lc3NhZ2VRdWV1ZSB7XG4gIF9sYXp5Q2FsbGFibGVNb2R1bGVzOiB7W2tleTogc3RyaW5nXTogKHZvaWQpID0+IHsuLi59LCAuLi59O1xuICBfcXVldWU6IFtudW1iZXJbXSwgbnVtYmVyW10sIG1peGVkW10sIG51bWJlcl07XG4gIF9zdWNjZXNzQ2FsbGJhY2tzOiBNYXA8bnVtYmVyLCA/KC4uLm1peGVkW10pID0+IHZvaWQ+O1xuICBfZmFpbHVyZUNhbGxiYWNrczogTWFwPG51bWJlciwgPyguLi5taXhlZFtdKSA9PiB2b2lkPjtcbiAgX2NhbGxJRDogbnVtYmVyO1xuICBfbGFzdEZsdXNoOiBudW1iZXI7XG4gIF9ldmVudExvb3BTdGFydFRpbWU6IG51bWJlcjtcbiAgX3JlYWN0TmF0aXZlTWljcm90YXNrc0NhbGxiYWNrOiA/KCkgPT4gdm9pZDtcblxuICBfZGVidWdJbmZvOiB7W251bWJlcl06IFtudW1iZXIsIG51bWJlcl0sIC4uLn07XG4gIF9yZW1vdGVNb2R1bGVUYWJsZToge1tudW1iZXJdOiBzdHJpbmcsIC4uLn07XG4gIF9yZW1vdGVNZXRob2RUYWJsZToge1tudW1iZXJdOiAkUmVhZE9ubHlBcnJheTxzdHJpbmc+LCAuLi59O1xuXG4gIF9fc3B5OiA/KGRhdGE6IFNweURhdGEpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlcyA9IHt9O1xuICAgIHRoaXMuX3F1ZXVlID0gW1tdLCBbXSwgW10sIDBdO1xuICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3MgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5fZmFpbHVyZUNhbGxiYWNrcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9jYWxsSUQgPSAwO1xuICAgIHRoaXMuX2xhc3RGbHVzaCA9IDA7XG4gICAgdGhpcy5fZXZlbnRMb29wU3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB0aGlzLl9yZWFjdE5hdGl2ZU1pY3JvdGFza3NDYWxsYmFjayA9IG51bGw7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fZGVidWdJbmZvID0ge307XG4gICAgICB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZSA9IHt9O1xuICAgICAgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGUgPSB7fTtcbiAgICB9XG5cbiAgICAvLyAkRmxvd0ZpeE1lW2Nhbm5vdC13cml0ZV1cbiAgICB0aGlzLmNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZSA9XG4gICAgICAvLyAkRmxvd0ZpeE1lW21ldGhvZC11bmJpbmRpbmddIGFkZGVkIHdoZW4gaW1wcm92aW5nIHR5cGluZyBmb3IgdGhpcyBwYXJhbWV0ZXJzXG4gICAgICB0aGlzLmNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZS5iaW5kKHRoaXMpO1xuICAgIC8vICRGbG93Rml4TWVbY2Fubm90LXdyaXRlXVxuICAgIC8vICRGbG93Rml4TWVbbWV0aG9kLXVuYmluZGluZ10gYWRkZWQgd2hlbiBpbXByb3ZpbmcgdHlwaW5nIGZvciB0aGlzIHBhcmFtZXRlcnNcbiAgICB0aGlzLmZsdXNoZWRRdWV1ZSA9IHRoaXMuZmx1c2hlZFF1ZXVlLmJpbmQodGhpcyk7XG5cbiAgICAvLyAkRmxvd0ZpeE1lW2Nhbm5vdC13cml0ZV1cbiAgICB0aGlzLmludm9rZUNhbGxiYWNrQW5kUmV0dXJuRmx1c2hlZFF1ZXVlID1cbiAgICAgIC8vICRGbG93Rml4TWVbbWV0aG9kLXVuYmluZGluZ10gYWRkZWQgd2hlbiBpbXByb3ZpbmcgdHlwaW5nIGZvciB0aGlzIHBhcmFtZXRlcnNcbiAgICAgIHRoaXMuaW52b2tlQ2FsbGJhY2tBbmRSZXR1cm5GbHVzaGVkUXVldWUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgQVBJc1xuICAgKi9cblxuICBzdGF0aWMgc3B5KHNweU9yVG9nZ2xlOiBib29sZWFuIHwgKChkYXRhOiBTcHlEYXRhKSA9PiB2b2lkKSkge1xuICAgIGlmIChzcHlPclRvZ2dsZSA9PT0gdHJ1ZSkge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IGluZm8gPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgJHtpbmZvLnR5cGUgPT09IFRPX0pTID8gJ04tPkpTJyA6ICdKUy0+Tid9IDogYCArXG4gICAgICAgICAgICBgJHtpbmZvLm1vZHVsZSAhPSBudWxsID8gaW5mby5tb2R1bGUgKyAnLicgOiAnJ30ke2luZm8ubWV0aG9kfWAgK1xuICAgICAgICAgICAgYCgke0pTT04uc3RyaW5naWZ5KGluZm8uYXJncyl9KWAsXG4gICAgICAgICk7XG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoc3B5T3JUb2dnbGUgPT09IGZhbHNlKSB7XG4gICAgICBNZXNzYWdlUXVldWUucHJvdG90eXBlLl9fc3B5ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IHNweU9yVG9nZ2xlO1xuICAgIH1cbiAgfVxuXG4gIGNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZShcbiAgICBtb2R1bGU6IHN0cmluZyxcbiAgICBtZXRob2Q6IHN0cmluZyxcbiAgICBhcmdzOiBtaXhlZFtdLFxuICApOiBudWxsIHwgW0FycmF5PG51bWJlcj4sIEFycmF5PG51bWJlcj4sIEFycmF5PG1peGVkPiwgbnVtYmVyXSB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19jYWxsRnVuY3Rpb24obW9kdWxlLCBtZXRob2QsIGFyZ3MpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuZmx1c2hlZFF1ZXVlKCk7XG4gIH1cblxuICBpbnZva2VDYWxsYmFja0FuZFJldHVybkZsdXNoZWRRdWV1ZShcbiAgICBjYklEOiBudW1iZXIsXG4gICAgYXJnczogbWl4ZWRbXSxcbiAgKTogbnVsbCB8IFtBcnJheTxudW1iZXI+LCBBcnJheTxudW1iZXI+LCBBcnJheTxtaXhlZD4sIG51bWJlcl0ge1xuICAgIHRoaXMuX19ndWFyZCgoKSA9PiB7XG4gICAgICB0aGlzLl9faW52b2tlQ2FsbGJhY2soY2JJRCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5mbHVzaGVkUXVldWUoKTtcbiAgfVxuXG4gIGZsdXNoZWRRdWV1ZSgpOiBudWxsIHwgW0FycmF5PG51bWJlcj4sIEFycmF5PG51bWJlcj4sIEFycmF5PG1peGVkPiwgbnVtYmVyXSB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19jYWxsUmVhY3ROYXRpdmVNaWNyb3Rhc2tzKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgIHRoaXMuX3F1ZXVlID0gW1tdLCBbXSwgW10sIHRoaXMuX2NhbGxJRF07XG4gICAgcmV0dXJuIHF1ZXVlWzBdLmxlbmd0aCA/IHF1ZXVlIDogbnVsbDtcbiAgfVxuXG4gIGdldEV2ZW50TG9vcFJ1bm5pbmdUaW1lKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIERhdGUubm93KCkgLSB0aGlzLl9ldmVudExvb3BTdGFydFRpbWU7XG4gIH1cblxuICByZWdpc3RlckNhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZywgbW9kdWxlOiB7Li4ufSkge1xuICAgIHRoaXMuX2xhenlDYWxsYWJsZU1vZHVsZXNbbmFtZV0gPSAoKSA9PiBtb2R1bGU7XG4gIH1cblxuICByZWdpc3RlckxhenlDYWxsYWJsZU1vZHVsZShuYW1lOiBzdHJpbmcsIGZhY3Rvcnk6IHZvaWQgPT4gaW50ZXJmYWNlIHt9KSB7XG4gICAgbGV0IG1vZHVsZTogaW50ZXJmYWNlIHt9O1xuICAgIGxldCBnZXRWYWx1ZTogPyh2b2lkKSA9PiBpbnRlcmZhY2Uge30gPSBmYWN0b3J5O1xuICAgIHRoaXMuX2xhenlDYWxsYWJsZU1vZHVsZXNbbmFtZV0gPSAoKSA9PiB7XG4gICAgICBpZiAoZ2V0VmFsdWUpIHtcbiAgICAgICAgbW9kdWxlID0gZ2V0VmFsdWUoKTtcbiAgICAgICAgZ2V0VmFsdWUgPSBudWxsO1xuICAgICAgfVxuICAgICAgLyogJEZsb3dGaXhNZVtjbGFzcy1vYmplY3Qtc3VidHlwaW5nXSBhZGRlZCB3aGVuIGltcHJvdmluZyB0eXBpbmcgZm9yXG4gICAgICAgKiB0aGlzIHBhcmFtZXRlcnMgKi9cbiAgICAgIHJldHVybiBtb2R1bGU7XG4gICAgfTtcbiAgfVxuXG4gIGdldENhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZyk6IHsuLi59IHwgbnVsbCB7XG4gICAgY29uc3QgZ2V0VmFsdWUgPSB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdO1xuICAgIHJldHVybiBnZXRWYWx1ZSA/IGdldFZhbHVlKCkgOiBudWxsO1xuICB9XG5cbiAgY2FsbE5hdGl2ZVN5bmNIb29rKFxuICAgIG1vZHVsZUlEOiBudW1iZXIsXG4gICAgbWV0aG9kSUQ6IG51bWJlcixcbiAgICBwYXJhbXM6IG1peGVkW10sXG4gICAgb25GYWlsOiA/KC4uLm1peGVkW10pID0+IHZvaWQsXG4gICAgb25TdWNjOiA/KC4uLm1peGVkW10pID0+IHZvaWQsXG4gICk6IG1peGVkIHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBnbG9iYWwubmF0aXZlQ2FsbFN5bmNIb29rLFxuICAgICAgICAnQ2FsbGluZyBzeW5jaHJvbm91cyBtZXRob2RzIG9uIG5hdGl2ZSAnICtcbiAgICAgICAgICAnbW9kdWxlcyBpcyBub3Qgc3VwcG9ydGVkIGluIENocm9tZS5cXG5cXG4gQ29uc2lkZXIgcHJvdmlkaW5nIGFsdGVybmF0aXZlICcgK1xuICAgICAgICAgICdtZXRob2RzIHRvIGV4cG9zZSB0aGlzIG1ldGhvZCBpbiBkZWJ1ZyBtb2RlLCBlLmcuIGJ5IGV4cG9zaW5nIGNvbnN0YW50cyAnICtcbiAgICAgICAgICAnYWhlYWQtb2YtdGltZS4nLFxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5wcm9jZXNzQ2FsbGJhY2tzKG1vZHVsZUlELCBtZXRob2RJRCwgcGFyYW1zLCBvbkZhaWwsIG9uU3VjYyk7XG4gICAgcmV0dXJuIGdsb2JhbC5uYXRpdmVDYWxsU3luY0hvb2sobW9kdWxlSUQsIG1ldGhvZElELCBwYXJhbXMpO1xuICB9XG5cbiAgcHJvY2Vzc0NhbGxiYWNrcyhcbiAgICBtb2R1bGVJRDogbnVtYmVyLFxuICAgIG1ldGhvZElEOiBudW1iZXIsXG4gICAgcGFyYW1zOiBtaXhlZFtdLFxuICAgIG9uRmFpbDogPyguLi5taXhlZFtdKSA9PiB2b2lkLFxuICAgIG9uU3VjYzogPyguLi5taXhlZFtdKSA9PiB2b2lkLFxuICApOiB2b2lkIHtcbiAgICBpZiAob25GYWlsIHx8IG9uU3VjYykge1xuICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgdGhpcy5fZGVidWdJbmZvW3RoaXMuX2NhbGxJRF0gPSBbbW9kdWxlSUQsIG1ldGhvZElEXTtcbiAgICAgICAgaWYgKHRoaXMuX2NhbGxJRCA+IERFQlVHX0lORk9fTElNSVQpIHtcbiAgICAgICAgICBkZWxldGUgdGhpcy5fZGVidWdJbmZvW3RoaXMuX2NhbGxJRCAtIERFQlVHX0lORk9fTElNSVRdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9zdWNjZXNzQ2FsbGJhY2tzLnNpemUgPiA1MDApIHtcbiAgICAgICAgICBjb25zdCBpbmZvOiB7W251bWJlcl06IHttZXRob2Q6IHN0cmluZywgbW9kdWxlOiBzdHJpbmd9fSA9IHt9O1xuICAgICAgICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3MuZm9yRWFjaCgoXywgY2FsbElEKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkZWJ1ZyA9IHRoaXMuX2RlYnVnSW5mb1tjYWxsSURdO1xuICAgICAgICAgICAgY29uc3QgbW9kdWxlID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbZGVidWdbMF1dO1xuICAgICAgICAgICAgY29uc3QgbWV0aG9kID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGVbZGVidWdbMF1dW2RlYnVnWzFdXTtcbiAgICAgICAgICAgIGluZm9bY2FsbElEXSA9IHttb2R1bGUsIG1ldGhvZH07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgd2Fybk9uY2UoXG4gICAgICAgICAgICAnZXhjZXNzaXZlLW51bWJlci1vZi1wZW5kaW5nLWNhbGxiYWNrcycsXG4gICAgICAgICAgICBgUGxlYXNlIHJlcG9ydDogRXhjZXNzaXZlIG51bWJlciBvZiBwZW5kaW5nIGNhbGxiYWNrczogJHtcbiAgICAgICAgICAgICAgdGhpcy5fc3VjY2Vzc0NhbGxiYWNrcy5zaXplXG4gICAgICAgICAgICB9LiBTb21lIHBlbmRpbmcgY2FsbGJhY2tzIHRoYXQgbWlnaHQgaGF2ZSBsZWFrZWQgYnkgbmV2ZXIgYmVpbmcgY2FsbGVkIGZyb20gbmF0aXZlIGNvZGU6ICR7c3RyaW5naWZ5U2FmZShcbiAgICAgICAgICAgICAgaW5mbyxcbiAgICAgICAgICAgICl9YCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBFbmNvZGUgY2FsbElEcyBpbnRvIHBhaXJzIG9mIGNhbGxiYWNrIGlkZW50aWZpZXJzIGJ5IHNoaWZ0aW5nIGxlZnQgYW5kIHVzaW5nIHRoZSByaWdodG1vc3QgYml0XG4gICAgICAvLyB0byBpbmRpY2F0ZSBmYWlsICgwKSBvciBzdWNjZXNzICgxKVxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgIG9uRmFpbCAmJiBwYXJhbXMucHVzaCh0aGlzLl9jYWxsSUQgPDwgMSk7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuICAgICAgb25TdWNjICYmIHBhcmFtcy5wdXNoKCh0aGlzLl9jYWxsSUQgPDwgMSkgfCAxKTtcbiAgICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3Muc2V0KHRoaXMuX2NhbGxJRCwgb25TdWNjKTtcbiAgICAgIHRoaXMuX2ZhaWx1cmVDYWxsYmFja3Muc2V0KHRoaXMuX2NhbGxJRCwgb25GYWlsKTtcbiAgICB9XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luQXN5bmNGbG93ICYmXG4gICAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luQXN5bmNGbG93KFxuICAgICAgICAgIFRSQUNFX1RBR19SRUFDVF9BUFBTLFxuICAgICAgICAgICduYXRpdmUnLFxuICAgICAgICAgIHRoaXMuX2NhbGxJRCxcbiAgICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5fY2FsbElEKys7XG4gIH1cblxuICBlbnF1ZXVlTmF0aXZlQ2FsbChcbiAgICBtb2R1bGVJRDogbnVtYmVyLFxuICAgIG1ldGhvZElEOiBudW1iZXIsXG4gICAgcGFyYW1zOiBtaXhlZFtdLFxuICAgIG9uRmFpbDogPyguLi5taXhlZFtdKSA9PiB2b2lkLFxuICAgIG9uU3VjYzogPyguLi5taXhlZFtdKSA9PiB2b2lkLFxuICApIHtcbiAgICB0aGlzLnByb2Nlc3NDYWxsYmFja3MobW9kdWxlSUQsIG1ldGhvZElELCBwYXJhbXMsIG9uRmFpbCwgb25TdWNjKTtcblxuICAgIHRoaXMuX3F1ZXVlW01PRFVMRV9JRFNdLnB1c2gobW9kdWxlSUQpO1xuICAgIHRoaXMuX3F1ZXVlW01FVEhPRF9JRFNdLnB1c2gobWV0aG9kSUQpO1xuXG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIC8vIFZhbGlkYXRlIHRoYXQgcGFyYW1ldGVycyBwYXNzZWQgb3ZlciB0aGUgYnJpZGdlIGFyZVxuICAgICAgLy8gZm9sbHktY29udmVydGlibGUuICBBcyBhIHNwZWNpYWwgY2FzZSwgaWYgYSBwcm9wIHZhbHVlIGlzIGFcbiAgICAgIC8vIGZ1bmN0aW9uIGl0IGlzIHBlcm1pdHRlZCBoZXJlLCBhbmQgc3BlY2lhbC1jYXNlZCBpbiB0aGVcbiAgICAgIC8vIGNvbnZlcnNpb24uXG4gICAgICBjb25zdCBpc1ZhbGlkQXJndW1lbnQgPSAodmFsOiBtaXhlZCkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHR5cGVvZiB2YWwpIHtcbiAgICAgICAgICBjYXNlICd1bmRlZmluZWQnOlxuICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgcmV0dXJuIGlzRmluaXRlKHZhbCk7XG4gICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICAgICAgICByZXR1cm4gdmFsLmV2ZXJ5KGlzVmFsaWRBcmd1bWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgayBpbiB2YWwpIHtcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWxba10gIT09ICdmdW5jdGlvbicgJiYgIWlzVmFsaWRBcmd1bWVudCh2YWxba10pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBSZXBsYWNlbWVudCBhbGxvd3Mgbm9ybWFsbHkgbm9uLUpTT04tY29udmVydGlibGUgdmFsdWVzIHRvIGJlXG4gICAgICAvLyBzZWVuLiAgVGhlcmUgaXMgYW1iaWd1aXR5IHdpdGggc3RyaW5nIHZhbHVlcywgYnV0IGluIGNvbnRleHQsXG4gICAgICAvLyBpdCBzaG91bGQgYXQgbGVhc3QgYmUgYSBzdHJvbmcgaGludC5cbiAgICAgIGNvbnN0IHJlcGxhY2VyID0gKGtleTogc3RyaW5nLCB2YWw6ICRGbG93Rml4TWUpID0+IHtcbiAgICAgICAgY29uc3QgdCA9IHR5cGVvZiB2YWw7XG4gICAgICAgIGlmICh0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcmV0dXJuICc8PEZ1bmN0aW9uICcgKyB2YWwubmFtZSArICc+Pic7XG4gICAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ251bWJlcicgJiYgIWlzRmluaXRlKHZhbCkpIHtcbiAgICAgICAgICByZXR1cm4gJzw8JyArIHZhbC50b1N0cmluZygpICsgJz4+JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBOb3RlIHRoYXQgSlNPTi5zdHJpbmdpZnlcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgaXNWYWxpZEFyZ3VtZW50KHBhcmFtcyksXG4gICAgICAgICclcyBpcyBub3QgdXNhYmxlIGFzIGEgbmF0aXZlIG1ldGhvZCBhcmd1bWVudCcsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHBhcmFtcywgcmVwbGFjZXIpLFxuICAgICAgKTtcblxuICAgICAgLy8gVGhlIHBhcmFtcyBvYmplY3Qgc2hvdWxkIG5vdCBiZSBtdXRhdGVkIGFmdGVyIGJlaW5nIHF1ZXVlZFxuICAgICAgZGVlcEZyZWV6ZUFuZFRocm93T25NdXRhdGlvbkluRGV2KHBhcmFtcyk7XG4gICAgfVxuICAgIHRoaXMuX3F1ZXVlW1BBUkFNU10ucHVzaChwYXJhbXMpO1xuXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBpZiAoXG4gICAgICBnbG9iYWwubmF0aXZlRmx1c2hRdWV1ZUltbWVkaWF0ZSAmJlxuICAgICAgbm93IC0gdGhpcy5fbGFzdEZsdXNoID49IE1JTl9USU1FX0JFVFdFRU5fRkxVU0hFU19NU1xuICAgICkge1xuICAgICAgY29uc3QgcXVldWUgPSB0aGlzLl9xdWV1ZTtcbiAgICAgIHRoaXMuX3F1ZXVlID0gW1tdLCBbXSwgW10sIHRoaXMuX2NhbGxJRF07XG4gICAgICB0aGlzLl9sYXN0Rmx1c2ggPSBub3c7XG4gICAgICBnbG9iYWwubmF0aXZlRmx1c2hRdWV1ZUltbWVkaWF0ZShxdWV1ZSk7XG4gICAgfVxuICAgIFN5c3RyYWNlLmNvdW50ZXJFdmVudCgncGVuZGluZ19qc190b19uYXRpdmVfcXVldWUnLCB0aGlzLl9xdWV1ZVswXS5sZW5ndGgpO1xuICAgIGlmIChfX0RFVl9fICYmIHRoaXMuX19zcHkgJiYgaXNGaW5pdGUobW9kdWxlSUQpKSB7XG4gICAgICB0aGlzLl9fc3B5KHtcbiAgICAgICAgdHlwZTogVE9fTkFUSVZFLFxuICAgICAgICBtb2R1bGU6IHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlW21vZHVsZUlEXSxcbiAgICAgICAgbWV0aG9kOiB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZVttb2R1bGVJRF1bbWV0aG9kSURdLFxuICAgICAgICBhcmdzOiBwYXJhbXMsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX19zcHkpIHtcbiAgICAgIHRoaXMuX19zcHkoe1xuICAgICAgICB0eXBlOiBUT19OQVRJVkUsXG4gICAgICAgIG1vZHVsZTogbW9kdWxlSUQgKyAnJyxcbiAgICAgICAgbWV0aG9kOiBtZXRob2RJRCxcbiAgICAgICAgYXJnczogcGFyYW1zLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY3JlYXRlRGVidWdMb29rdXAoXG4gICAgbW9kdWxlSUQ6IG51bWJlcixcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgbWV0aG9kczogPyRSZWFkT25seUFycmF5PHN0cmluZz4sXG4gICkge1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZVttb2R1bGVJRF0gPSBuYW1lO1xuICAgICAgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGVbbW9kdWxlSURdID0gbWV0aG9kcyB8fCBbXTtcbiAgICB9XG4gIH1cblxuICAvLyBGb3IgSlNUaW1lcnMgdG8gcmVnaXN0ZXIgaXRzIGNhbGxiYWNrLiBPdGhlcndpc2UgYSBjaXJjdWxhciBkZXBlbmRlbmN5XG4gIC8vIGJldHdlZW4gbW9kdWxlcyBpcyBpbnRyb2R1Y2VkLiBOb3RlIHRoYXQgb25seSBvbmUgY2FsbGJhY2sgbWF5IGJlXG4gIC8vIHJlZ2lzdGVyZWQgYXQgYSB0aW1lLlxuICBzZXRSZWFjdE5hdGl2ZU1pY3JvdGFza3NDYWxsYmFjayhmbjogKCkgPT4gdm9pZCkge1xuICAgIHRoaXMuX3JlYWN0TmF0aXZlTWljcm90YXNrc0NhbGxiYWNrID0gZm47XG4gIH1cblxuICAvKipcbiAgICogUHJpdmF0ZSBtZXRob2RzXG4gICAqL1xuXG4gIF9fZ3VhcmQoZm46ICgpID0+IHZvaWQpIHtcbiAgICBpZiAodGhpcy5fX3Nob3VsZFBhdXNlT25UaHJvdygpKSB7XG4gICAgICBmbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0cnkge1xuICAgICAgICBmbigpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgRXJyb3JVdGlscy5yZXBvcnRGYXRhbEVycm9yKGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBNZXNzYWdlUXVldWUgaW5zdGFsbHMgYSBnbG9iYWwgaGFuZGxlciB0byBjYXRjaCBhbGwgZXhjZXB0aW9ucyB3aGVyZSBKUyB1c2VycyBjYW4gcmVnaXN0ZXIgdGhlaXIgb3duIGJlaGF2aW9yXG4gIC8vIFRoaXMgaGFuZGxlciBtYWtlcyBhbGwgZXhjZXB0aW9ucyB0byBiZSBwcm9wYWdhdGVkIGZyb20gaW5zaWRlIE1lc3NhZ2VRdWV1ZSByYXRoZXIgdGhhbiBieSB0aGUgVk0gYXQgdGhlaXIgb3JpZ2luXG4gIC8vIFRoaXMgbWFrZXMgc3RhY2t0cmFjZXMgdG8gYmUgcGxhY2VkIGF0IE1lc3NhZ2VRdWV1ZSByYXRoZXIgdGhhbiBhdCB3aGVyZSB0aGV5IHdlcmUgbGF1bmNoZWRcbiAgLy8gVGhlIHBhcmFtZXRlciBEZWJ1Z2dlckludGVybmFsLnNob3VsZFBhdXNlT25UaHJvdyBpcyB1c2VkIHRvIGNoZWNrIGJlZm9yZSBjYXRjaGluZyBhbGwgZXhjZXB0aW9ucyBhbmRcbiAgLy8gY2FuIGJlIGNvbmZpZ3VyZWQgYnkgdGhlIFZNIG9yIGFueSBJbnNwZWN0b3JcbiAgX19zaG91bGRQYXVzZU9uVGhyb3coKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIC8vICRGbG93Rml4TWVbY2Fubm90LXJlc29sdmUtbmFtZV1cbiAgICAgIHR5cGVvZiBEZWJ1Z2dlckludGVybmFsICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgRGVidWdnZXJJbnRlcm5hbC5zaG91bGRQYXVzZU9uVGhyb3cgPT09IHRydWUgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZlxuICAgICk7XG4gIH1cblxuICBfX2NhbGxSZWFjdE5hdGl2ZU1pY3JvdGFza3MoKSB7XG4gICAgU3lzdHJhY2UuYmVnaW5FdmVudCgnSlNUaW1lcnMuY2FsbFJlYWN0TmF0aXZlTWljcm90YXNrcygpJyk7XG4gICAgaWYgKHRoaXMuX3JlYWN0TmF0aXZlTWljcm90YXNrc0NhbGxiYWNrICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3JlYWN0TmF0aXZlTWljcm90YXNrc0NhbGxiYWNrKCk7XG4gICAgfVxuICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gIH1cblxuICBfX2NhbGxGdW5jdGlvbihtb2R1bGU6IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIGFyZ3M6IG1peGVkW10pOiB2b2lkIHtcbiAgICB0aGlzLl9sYXN0Rmx1c2ggPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZSA9IHRoaXMuX2xhc3RGbHVzaDtcbiAgICBpZiAoX19ERVZfXyB8fCB0aGlzLl9fc3B5KSB7XG4gICAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KGAke21vZHVsZX0uJHttZXRob2R9KCR7c3RyaW5naWZ5U2FmZShhcmdzKX0pYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoYCR7bW9kdWxlfS4ke21ldGhvZH0oLi4uKWApO1xuICAgIH1cbiAgICBpZiAodGhpcy5fX3NweSkge1xuICAgICAgdGhpcy5fX3NweSh7dHlwZTogVE9fSlMsIG1vZHVsZSwgbWV0aG9kLCBhcmdzfSk7XG4gICAgfVxuICAgIGNvbnN0IG1vZHVsZU1ldGhvZHMgPSB0aGlzLmdldENhbGxhYmxlTW9kdWxlKG1vZHVsZSk7XG4gICAgaWYgKCFtb2R1bGVNZXRob2RzKSB7XG4gICAgICBjb25zdCBjYWxsYWJsZU1vZHVsZU5hbWVzID0gT2JqZWN0LmtleXModGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlcyk7XG4gICAgICBjb25zdCBuID0gY2FsbGFibGVNb2R1bGVOYW1lcy5sZW5ndGg7XG4gICAgICBjb25zdCBjYWxsYWJsZU1vZHVsZU5hbWVMaXN0ID0gY2FsbGFibGVNb2R1bGVOYW1lcy5qb2luKCcsICcpO1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgYEZhaWxlZCB0byBjYWxsIGludG8gSmF2YVNjcmlwdCBtb2R1bGUgbWV0aG9kICR7bW9kdWxlfS4ke21ldGhvZH0oKS4gTW9kdWxlIGhhcyBub3QgYmVlbiByZWdpc3RlcmVkIGFzIGNhbGxhYmxlLiBSZWdpc3RlcmVkIGNhbGxhYmxlIEphdmFTY3JpcHQgbW9kdWxlcyAobiA9ICR7bn0pOiAke2NhbGxhYmxlTW9kdWxlTmFtZUxpc3R9LlxuICAgICAgICBBIGZyZXF1ZW50IGNhdXNlIG9mIHRoZSBlcnJvciBpcyB0aGF0IHRoZSBhcHBsaWNhdGlvbiBlbnRyeSBmaWxlIHBhdGggaXMgaW5jb3JyZWN0LiBUaGlzIGNhbiBhbHNvIGhhcHBlbiB3aGVuIHRoZSBKUyBidW5kbGUgaXMgY29ycnVwdCBvciB0aGVyZSBpcyBhbiBlYXJseSBpbml0aWFsaXphdGlvbiBlcnJvciB3aGVuIGxvYWRpbmcgUmVhY3QgTmF0aXZlLmAsXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoIW1vZHVsZU1ldGhvZHNbbWV0aG9kXSkge1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgYEZhaWxlZCB0byBjYWxsIGludG8gSmF2YVNjcmlwdCBtb2R1bGUgbWV0aG9kICR7bW9kdWxlfS4ke21ldGhvZH0oKS4gTW9kdWxlIGV4aXN0cywgYnV0IHRoZSBtZXRob2QgaXMgdW5kZWZpbmVkLmAsXG4gICAgICApO1xuICAgIH1cbiAgICBtb2R1bGVNZXRob2RzW21ldGhvZF0uYXBwbHkobW9kdWxlTWV0aG9kcywgYXJncyk7XG4gICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgfVxuXG4gIF9faW52b2tlQ2FsbGJhY2soY2JJRDogbnVtYmVyLCBhcmdzOiBtaXhlZFtdKSB7XG4gICAgdGhpcy5fbGFzdEZsdXNoID0gRGF0ZS5ub3coKTtcbiAgICB0aGlzLl9ldmVudExvb3BTdGFydFRpbWUgPSB0aGlzLl9sYXN0Rmx1c2g7XG5cbiAgICAvLyBUaGUgcmlnaHRtb3N0IGJpdCBvZiBjYklEIGluZGljYXRlcyBmYWlsICgwKSBvciBzdWNjZXNzICgxKSwgdGhlIG90aGVyIGJpdHMgYXJlIHRoZSBjYWxsSUQgc2hpZnRlZCBsZWZ0LlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gICAgY29uc3QgY2FsbElEID0gY2JJRCA+Pj4gMTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZVxuICAgIGNvbnN0IGlzU3VjY2VzcyA9IGNiSUQgJiAxO1xuICAgIGNvbnN0IGNhbGxiYWNrID0gaXNTdWNjZXNzXG4gICAgICA/IHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3MuZ2V0KGNhbGxJRClcbiAgICAgIDogdGhpcy5fZmFpbHVyZUNhbGxiYWNrcy5nZXQoY2FsbElEKTtcblxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBjb25zdCBkZWJ1ZyA9IHRoaXMuX2RlYnVnSW5mb1tjYWxsSURdO1xuICAgICAgY29uc3QgbW9kdWxlID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbZGVidWdbMF1dO1xuICAgICAgY29uc3QgbWV0aG9kID0gZGVidWcgJiYgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGVbZGVidWdbMF1dW2RlYnVnWzFdXTtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgY2FsbGJhY2ssXG4gICAgICAgIGBObyBjYWxsYmFjayBmb3VuZCB3aXRoIGNiSUQgJHtjYklEfSBhbmQgY2FsbElEICR7Y2FsbElEfSBmb3IgYCArXG4gICAgICAgICAgKG1ldGhvZFxuICAgICAgICAgICAgPyBgICR7bW9kdWxlfS4ke21ldGhvZH0gLSBtb3N0IGxpa2VseSB0aGUgY2FsbGJhY2sgd2FzIGFscmVhZHkgaW52b2tlZGBcbiAgICAgICAgICAgIDogYG1vZHVsZSAke21vZHVsZSB8fCAnPHVua25vd24+J31gKSArXG4gICAgICAgICAgYC4gQXJnczogJyR7c3RyaW5naWZ5U2FmZShhcmdzKX0nYCxcbiAgICAgICk7XG4gICAgICBjb25zdCBwcm9maWxlTmFtZSA9IGRlYnVnXG4gICAgICAgID8gJzxjYWxsYmFjayBmb3IgJyArIG1vZHVsZSArICcuJyArIG1ldGhvZCArICc+J1xuICAgICAgICA6IGNiSUQ7XG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdGhpcy5fX3NweSkge1xuICAgICAgICB0aGlzLl9fc3B5KHt0eXBlOiBUT19KUywgbW9kdWxlOiBudWxsLCBtZXRob2Q6IHByb2ZpbGVOYW1lLCBhcmdzfSk7XG4gICAgICB9XG4gICAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KFxuICAgICAgICBgTWVzc2FnZVF1ZXVlLmludm9rZUNhbGxiYWNrKCR7cHJvZmlsZU5hbWV9LCAke3N0cmluZ2lmeVNhZmUoYXJncyl9KWAsXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICghY2FsbGJhY2spIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9zdWNjZXNzQ2FsbGJhY2tzLmRlbGV0ZShjYWxsSUQpO1xuICAgIHRoaXMuX2ZhaWx1cmVDYWxsYmFja3MuZGVsZXRlKGNhbGxJRCk7XG4gICAgY2FsbGJhY2soLi4uYXJncyk7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBNZXNzYWdlUXVldWU7XG4iXSwibWFwcGluZ3MiOiJBQVVBOzs7Ozs7Ozs7O0FBRUEsSUFBTUEsUUFBUSxHQUFH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